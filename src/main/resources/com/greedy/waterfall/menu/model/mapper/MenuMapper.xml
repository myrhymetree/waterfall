<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.greedy.waterfall.menu.model.mapper.MenuMapper">
	<resultMap type="com.greedy.waterfall.project.model.dto.ProjectDTO" id="projectResult">
		<id property="no" column="PROJECT_NO"/>
		<result property="name" column="PROJECT_NAME"/>	
		<result property="startDate" column="PROJECT_START_DATE"/>
		<result property="deadLine" column="PROJECT_DEADLINE"/>
		<result property="progression" column="PROJECT_PROGRESSION"/>
		<result property="status" column="PROJECT_STATUS"/>
		<result property="completed" column="PROJECT_COMPLETED_DATE"/>
		<result property="statusCode" column="PROJECT_PROGRESS_STATUS_CODE"/>
		<result property="outputCount" column="OUTPUT_COUNT"/>
		<result property="issueCount" column="ISSUE_COUNT"/>
		
		<association property="member" resultMap="memberResult"></association>
		<association property="projectInfo" resultMap="projectInfoResult"></association>
	</resultMap>
	
	<resultMap type="com.greedy.waterfall.board.model.dto.MeetingMemberDTO" id="memberResult">
		<result property="memberName" column="MEMBER_NAME"/>
	</resultMap>
	
	<resultMap type="com.greedy.waterfall.menu.model.dto.ProjectInfoDTO" id="projectInfoResult">
		<result property="outputAmount" column="OUTPUT_AMOUNT"/>
		<result property="causedIssueAmount" column="CAUSED_ISSUE"/>
		<result property="solvedIssueAmount" column="SOLVED_ISSUE"/>
		<result property="finishedTaskAmount" column="FINISH_TASK"/>
		<result property="progressingTaskAmount" column="PROGRESS_TASK"/>
	</resultMap>

	<select id="findProjectInfo" resultMap="projectResult">

	
	</select>

	<select id="findProjectCount" resultType="_int">
        SELECT  
               COUNT(*)
          FROM TBL_PROJECT A
         WHERE A.PROJECT_STATUS = 'Y'
	</select>
	<select id="findMainProjectList" resultMap="projectResult">
        SELECT 
               RNUM
             , A.PROJECT_NO
             , A.PROJECT_NAME
             , A.MEMBER_NAME
          FROM (SELECT ROWNUM RNUM
                     , B.PROJECT_NO
                     , B.PROJECT_NAME
                     , B.MEMBER_NAME
                  FROM (SELECT D.PROJECT_NO
                             , D.PROJECT_NAME
                             , E.MEMBER_NO
                             , E.MEMBER_NAME
                         FROM TBL_ROLE_ASSIGNMENT_HISTORY C
                         JOIN TBL_PROJECT D ON (C.PROJECT_NO = D.PROJECT_NO)
                         JOIN TBL_MEMBER E ON (C.MEMBER_NO = E.MEMBER_NO)
                        WHERE C.ROLE_NO = 8
                          AND D.PROJECT_STATUS = 'Y'
                        ORDER BY C.PROJECT_NO DESC
                       ) B
				<![CDATA[
                 WHERE ROWNUM <= #{ endRow }
				]]>
               ) A
         WHERE RNUM >= #{ startRow }
	</select>



</mapper>