<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.greedy.waterfall.board.model.guidemapper.GuideMapper">
  	<resultMap type="com.greedy.waterfall.board.model.dto.GuideDTO" id="guideResultMap">
  		<id property="no" column="BOARD_NO"></id>
  		<result property="postingDate" column="BOARD_POSTING_DATE"/>
  		<result property="title" column="BOARD_TITLE"/>
  		<result property="content" column="BOARD_CONTENT"/>
  		<result property="status" column="BOARD_STATUS"/>
  		<result property="projectNo" column="PROJECT_NO"/>
  		<result property="categoryNo" column="BOARD_CATEGORY_NO"/>
  		<result property="updatedDate" column="BOARD_UPDATED_DATE"/>
  		<result property="count" column="BOARD_COUNT"/>
  		<result property="writerMemberNo" column="MEMBER_NO"/>
  		<result property="rnum" column="RNUM"/>
  		
  		<association property="writer" resultMap="memberResultMap"/>
  	</resultMap>
  	
  	<resultMap type="com.greedy.waterfall.board.model.dto.GuideMemberDTO" id="memberResultMap">
  		<id property="no" column="MEMBER_NO"/>
  		<result property="name" column="MEMBER_NAME"/>
  	</resultMap>
  	
  
  <select id="selectAllGuideList" resultMap="guideResultMap"> SELECT /* com.greedy.waterfall.board.model.guidemapper.GuideMapper#selectAllGuideList() */
  	       A.RNUM
  	     , A.BOARD_NO
  	     , A.BOARD_TITLE
  	     , A.BOARD_CONTENT
  	     , A.BOARD_STATUS
  	     , A.BOARD_CATEGORY_NO
  	     , A.BOARD_UPDATED_DATE
  	     , A.BOARD_COUNT
  	     , A.MEMBER_NO
       	 , A.PROJECT_NO 
  	     , E.MEMBER_NAME
  	 FROM ( SELECT ROWNUM RNUM
  	             , B.BOARD_NO
  	             , B.BOARD_TITLE
  	             , B.BOARD_CONTENT
  	             , B.BOARD_STATUS
  	             , B.BOARD_CATEGORY_NO
  	             , B.BOARD_UPDATED_DATE
  	             , B.BOARD_COUNT
  	             , B.PROJECT_NO
  	             , B.MEMBER_NO
  	          FROM ( SELECT C.BOARD_NO
  	                      , C.BOARD_TITLE
  	                      , C.BOARD_CONTENT
  	                      , C.BOARD_STATUS
  	                      , C.BOARD_CATEGORY_NO
  	                      , C.BOARD_UPDATED_DATE
  	                      , C.BOARD_COUNT
  	                      , C.PROJECT_NO
  	                      , C.MEMBER_NO
  	                   FROM TBL_BOARD C
  	                  <where>
  	                  	<if test="searchCondition == 'title'">
  	                  		C.BOARD_TITLE LIKE '%' || #{ searchValue } || '%'
  	                  	</if>
  	                  	<if test="searchCondition == 'content'">
  	                  		C.BOARD_CONTENT LIKE '%' || #{ searchValue } || '%'
  	                  	</if>
  	                    AND C.BOARD_STATUS = 'Y'
  	                    AND C.BOARD_CATEGORY_NO = 3
  	                  </where>
  	                  ORDER BY C.BOARD_NO DESC
  	          		  ) B
  	          		  <![CDATA[
  	          		  WHERE ROWNUM <= #{ endRow }
  	          		  ]]>
  	 				) A
  	 		   JOIN TBL_MEMBER E ON (A.MEMBER_NO = E.MEMBER_NO)
  	 		  WHERE A.RNUM >= #{ startRow }
  	 		  ORDER BY 1 ASC
  </select>
  
  <select id="selectTotalCount" resultType="_int" parameterType="hashmap">
  	SELECT /* com.greedy.waterfall.board.model.guidemapper.GuideMapper#selectTotalCount() */
  		   COUNT(*)
  	  FROM TBL_BOARD A
  	 <where>
  	 	<if test="searchCondition == 'title'">
  	    	A.BOARD_TITLE LIKE '%' || #{ searchValue } || '%'
  	 	</if>
  	 	<if test="searchCondition == 'content'">
  	 		A.BOARD_CONTENT LIKE '%' || #{ searchValue } || '%'
  	 	</if>
  	   AND A.BOARD_STATUS = 'Y'
  	   AND A.BOARD_CATEGORY_NO = 3
  	 </where>
  </select>
  
  <insert id="insertGuide" parameterType="com.greedy.waterfall.board.model.dto.GuideDTO">
  	INSERT /* com.greedy.waterfall.board.model.guidemapper.GuideMapper#insertGuide() */
  	  INTO TBL_BOARD A
  	(
	  A.BOARD_NO
	, A.BOARD_CATEGORY_NO
	, A.BOARD_TITLE
	, A.BOARD_CONTENT
	, A.PROJECT_NO
	, A.MEMBER_NO 	  
  	)
  	VALUES
  	(
  	  BOARD_NO.NEXTVAL
  	, 3 
  	, #{ title }
  	, #{ content }
	, 3
	, 1
  	)
  </insert>
  
  <delete id="deleteGuide" parameterType="_int">
  	DELETE /* com.greedy.waterfall.board.model.guidemapper.GuideMapper#deleteGuide() */
  	  FROM TBL_BOARD A
     WHERE A.BOARD_NO = #{ no }
  </delete>
  
  <update id="updateGuide" parameterType="com.greedy.waterfall.board.model.dto.GuideDTO">
  	UPDATE /* com.greedy.waterfall.board.model.guidemapper.GuideMapper#updateGuide() */
  	       TBL_BOARD A
  	   SET A.BOARD_TITLE = #{ title } 
  	     , A.BOARD_CONTENT = #{ content }
  	 WHERE A.BOARD_NO = #{ no }
  </update>
  
  <update id="incrementGuideCount">
      UPDATE 
               TBL_BOARD A
           SET A.BOARD_COUNT = (SELECT B.BOARD_COUNT
                                   FROM TBL_BOARD B
                                  WHERE B.BOARD_NO = #{ no }
                                ) + 1
         WHERE A.BOARD_NO = #{ no }
   </update>
  
  <select id="selectGuideDetail" resultMap="guideResultMap">
      SELECT
               A.BOARD_NO
             , A.BOARD_UPDATED_DATE
             , A.BOARD_POSTING_DATE
             , A.BOARD_TITLE
             , A.BOARD_CONTENT
             , A.MEMBER_NO
             , B.MEMBER_NAME
             , A.BOARD_COUNT
             , A.BOARD_POSTING_DATE
             , A.BOARD_STATUS
             , A.PROJECT_NO
          FROM TBL_BOARD A
          JOIN TBL_MEMBER B ON (A.MEMBER_NO = B.MEMBER_NO)
         WHERE A.BOARD_NO = #{ guideNo }
   </select>
  
</mapper>