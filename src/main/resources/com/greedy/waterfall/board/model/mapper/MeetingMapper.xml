<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.greedy.waterfall.board.model.mapper.MeetingMapper">


	<resultMap type="com.greedy.waterfall.board.model.dto.MeetingDTO" id="meetingResult">
	 	<id property="no" column="BOARD_NO"/>
	 	<result property="updatedDate" column="BOARD_UPDATED_DATE"/>
	 	<result property="registedDate" column="BOARD_POSTING_DATE"/>
	 	<result property="title" column="BOARD_TITLE"/>
	 	<result property="content" column="BOARD_CONTENT"/>
	 	<result property="status" column="BOARD_STATUS"/>
	 	<result property="boardCategoryNo" column="BOARD_CATEGORY_NO"/>
	 	<result property="boardCount" column="BOARD_COUNT"/>
	 	<result property="projectNo" column="PROJECT_NO"/>
	 	<result property="memberNo" column="MEMBER_NO"/>
	 	
	 	<association property="member" resultMap="memberResultMap" />
 	</resultMap>
 	
 	<resultMap type="com.greedy.waterfall.board.model.dto.MeetingMemberDTO" id="memberResultMap">
		<id property="memberNo" column="MEMBER_NO"/>
		<result property="memberName" column="MEMBER_NAME"/>
	</resultMap>
	<resultMap type="com.greedy.waterfall.board.model.dto.MeetingProjectDTO" id="projectResultMap">
		<id property="no" column="MEMBER_NO"/>
	</resultMap>

	<!--#보류 projectNo, memberNo 기능 추가될시 수정 -->
	<insert id="registMeetingBoard" parameterType="hashmap">
        INSERT
          INTO TBL_BOARD A
        (
          A.BOARD_NO
        , A.BOARD_POSTING_DATE
        , A.BOARD_TITLE
        , A.BOARD_CONTENT
        , A.BOARD_STATUS
        , A.PROJECT_NO
        , A.BOARD_CATEGORY_NO
        , A.MEMBER_NO
        , A.BOARD_COUNT
        )
        VALUES
        (
          BOARD_NO.NEXTVAL
        , SYSDATE
        , #{ title }
        , #{ content }
        , 'Y'
        , 3
        , 4
        , 1
        , 0
        )
	</insert>

	<select id="findMeetingList" resultMap="meetingResult">
       SELECT 
              A.RNUM
            , A.BOARD_NO
            , A.BOARD_POSTING_DATE
            , A.BOARD_TITLE
            , A.BOARD_CONTENT
            , A.BOARD_STATUS
            , A.PROJECT_NO
            , A.BOARD_CATEGORY_NO
            , A.BOARD_UPDATED_DATE
            , A.MEMBER_NAME
            , A.BOARD_COUNT
         FROM (SELECT ROWNUM RNUM
                    , B.BOARD_NO
                    , B.BOARD_POSTING_DATE
                    , B.BOARD_TITLE
                    , B.BOARD_CONTENT
                    , B.BOARD_STATUS
                    , B.PROJECT_NO
                    , B.BOARD_CATEGORY_NO
                    , B.BOARD_UPDATED_DATE
                    , B.MEMBER_NAME
                    , B.BOARD_COUNT
                 FROM (SELECT C.BOARD_NO
                            , C.BOARD_POSTING_DATE
                            , C.BOARD_TITLE
                            , C.BOARD_CONTENT
                            , C.BOARD_STATUS
                            , C.PROJECT_NO
                            , C.BOARD_CATEGORY_NO
                            , C.BOARD_UPDATED_DATE
                            , D.MEMBER_NAME
                            , C.BOARD_COUNT
                         FROM TBL_BOARD C
                         JOIN TBL_MEMBER D ON (C.MEMBER_NO = D.MEMBER_NO)
                   		<where>
                   			<if test="searchCondition == 'title'">
                              C.BOARD_TITLE LIKE '%' || #{ searchValue } || '%'
							</if>
                   			<if test="searchCondition == 'content'">
                              C.BOARD_CONTENT LIKE '%'|| #{ searchValue } || '%'
							</if>
                   			<if test="searchCondition == 'writer'">
                              D.MEMBER_NAME LIKE '%'|| #{ searchValue } || '%'
							</if> 
                          AND C.BOARD_CATEGORY_NO = 4
                          AND C.BOARD_STATUS = 'Y'
						</where>	      
                        ORDER BY C.BOARD_NO DESC
                      ) B    
                <![CDATA[     
                WHERE ROWNUM <= #{ endRow }
                ]]>
              )A   
        WHERE  RNUM >= #{ startRow }
	</select>
	<select id="findMeetingBoardDetail" resultMap="meetingResult">
       SELECT
              A.BOARD_NO
            , A.BOARD_POSTING_DATE
            , A.BOARD_TITLE
            , A.BOARD_CONTENT
            , A.BOARD_STATUS
            , A.PROJECT_NO
            , A.BOARD_CATEGORY_NO
            , A.BOARD_UPDATED_DATE
            , B.MEMBER_NAME
            , A.BOARD_COUNT
         FROM TBL_BOARD A
         JOIN TBL_MEMBER B ON(A.MEMBER_NO = B.MEMBER_NO)
        WHERE A.BOARD_CATEGORY_NO = 4
          AND A.BOARD_STATUS = 'Y'
          AND A.BOARD_NO = #{ meetingNo }
	</select>
	
	<select id="findMeetingTotalCount" resultType="_int" parameterType="hashmap">
        SELECT
               COUNT(*)
          FROM TBL_BOARD A
		<if test="searchCondition == 'writer'">
          JOIN TBL_MEMBER B ON(A.MEMBER_NO = B.MEMBER_NO)
		</if>
		<where>
			<if test="searchCondition == 'writer'" >
               B.MEMBER_NAME LIKE '%' || #{ searchValue } || '%'
			</if>
			<if test="searchCondition == 'title'" >
               A.BOARD_TITLE LIKE '%' || #{ searchValue } || '%'
			</if>
			<if test="searchCondition == 'content'" >
               A.BOARD_CONTENT LIKE '%' || #{ searchValue } || '%'			
			</if>
           AND A.BOARD_STATUS = 'Y'
           AND A.BOARD_CATEGORY_NO = 4
		</where>
	</select>	
	<delete id="removeMeetingBoard" parameterType="_int">
        DELETE
          FROM TBL_BOARD A
         WHERE A.BOARD_CATEGORY_NO = 4
           AND A.BOARD_NO = #{ meetingNo }	
	</delete>
	<update id="modifyMeetingBoard" parameterType="hashmap">
        UPDATE
               TBL_BOARD A
           SET BOARD_UPDATED_DATE = SYSDATE
             , A.BOARD_TITLE = #{ title }
             , A.BOARD_CONTENT = #{ content }
         WHERE A.BOARD_NO = #{ no } 
	</update>
	<select id="findOneMeetingBoard" resultMap="meetingResult">
        SELECT
               A.BOARD_NO
             , A.BOARD_UPDATED_DATE
             , A.BOARD_POSTING_DATE
             , A.BOARD_TITLE
             , A.BOARD_CONTENT
             , A.BOARD_STATUS
             , A.BOARD_CATEGORY_NO
             , A.PROJECT_NO
             , A.MEMBER_NO
          FROM TBL_BOARD A
         WHERE A.BOARD_NO = #{ meetingNo }
	</select>	
</mapper>








































































